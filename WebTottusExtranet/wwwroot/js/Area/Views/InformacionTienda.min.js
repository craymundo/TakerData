const mainmntolocales=function(){var n=this;n.Globals={tblinformaciontienda:$("#tblinformaciontienda"),tipo:$("#cboTipo"),cluster:$("#cboCluster"),estado:$("#cboEstado"),esPuntoRetiro:$("input:radio[name=radioInline]")};n.GlobalModal={formulario:$("#modal-form-modal"),title:$("#Modal-Title"),idLocal:$("#hddIdLocal"),codigo:$("#txtCodigo"),nombre:$("#txtNombre"),nombrealternativo:$("#txtNombreAlternativo"),direccion:$("#txtDireccion"),tipo:$("#cboTipoLocalModal"),cluster:$("#cboClusterModal"),estado:$("#cboEstadoModal"),departamento:$("#txtDepartamento"),provincia:$("#txtProvincia"),distrito:$("#txtDistrito"),dias:$("#txtDias"),horario:$("#txtHorario"),telefono:$("#txtTelefono"),x:$("#txtCoordenadax"),y:$("#txtCoordenaday"),ubicacion:$("#txtUbicacion"),imagenLocal:$("#imagenLocal"),esPuntoRetiro:$("input:radio[name=radioInlinemodal]")};n.GlobalModalVer={title:$("#Modal-Title-Ver"),codigo:$("#txtCodigoModalView"),nombre:$("#txtNombreModalView"),nombrealternativo:$("#txtNombreAlternativoModalView"),direccion:$("#txtDireccionModalView"),tipo:$("#txtTipoLocalModalView"),cluster:$("#txtClusterModalView"),estado:$("#txtEstadoModalView"),departamento:$("#txtDepartamentoModalView"),provincia:$("#txtProvinciaModalView"),distrito:$("#txtDistritoModalView"),dias:$("#txtDiasModalView"),horario:$("#txtHorarioModalView"),telefono:$("#txtTelefonoModalView"),x:$("#txtCoordenadaxModalView"),y:$("#txtCoordenadayModalView"),ubicacion:$("#txtUbicacionModalView"),imagenLocal:$("#imagenLocalView")};n.GlobalModalEstado={formulario:$("#modal-form-estado"),title:$("#Modal-Title-Estado"),nota:$("#txtNota"),bottonestado:$("#btnEstado"),IdEstado:$("#hddIdEstado")};n.GlobalModalImagen={formulario:$("#dropzoneForm")};n.Funciones={InicializarEventos:function(){$(document).on("click","#btnBuscar",n.Eventos.ValidaListar);$(document).on("click","#btnRegistrar",n.Eventos.ValidaRegistrar);$(document).on("click","#tblinformaciontienda tr td #lnkVer",n.Eventos.ValidaVer);$(document).on("click","#tblinformaciontienda tr td #lnkActualizar",n.Eventos.ValidaActulizar);$(document).on("click","#tblinformaciontienda tr td #lnkActivar",n.Eventos.ValidaActivar);$(document).on("click","#tblinformaciontienda tr td #lnkDesactivar",n.Eventos.ValidaDesactivar);$(document).on("click","#tblinformaciontienda tr td #lnkUpload",n.Eventos.ValidaUploadImage)},InicializarAcciones:function(){n.Funciones.InicializarDatatable(n.Globals.tblinformaciontienda)},InicializarDatatable:function(t){t.ClearDataTable();t.SetDataTableResponseLoad(n.Funciones.DatatableColumn())},Carga:function(t,i){coreajax.ajax.PostAsync(t,i,function(t){t.success?(n.Globals.cluster.CreateSelected(t.result.clusterLocal,"idClusterLocal","descripcion"),n.Globals.tipo.CreateSelected(t.result.tipoLocal,"idTipoLocal","descripcion"),n.Globals.estado.CreateSelected(t.result.estadoLocal,"idEstadoLocal","descripcion"),n.Globals.tipo.prop("selectedIndex",1),n.GlobalModal.idLocal.val("0")):toastr.error(t.message,conexion.titulo,{timeOut:1e3});$.msg("unblock")})},Listar:function(t,i){coreajax.ajax.PostAsync(t,i,function(t){t.success?n.Globals.tblinformaciontienda.SetDataTableResponseNoButtons(n.Funciones.DatatableColumn(),t.result):toastr.error(t.message,conexion.titulo,{timeOut:1e3});$.msg("unblock")})},DatatableColumn:function(){return{columns:[{title:"Codigo",data:"codigoLocal",visible:!0,width:"60px","class":"dt-center"},{title:"Nombre",data:"descripcionLocal",visible:!0,width:"150px","class":"dt-center"},{title:"Tipo local",data:null,width:"150px",className:"dt-center",mRender:function(n){return n.tipoLocal.descripcion}},{title:"Punto Retiro",data:null,visible:!0,width:"60px",className:"dt-center",mRender:function(n){return n.esPuntoRetiro?'<i class="fa fa-check" style="color:green;"><\/i>':""}},{title:"Distrito/Comuna",data:null,visible:!0,width:"100px",className:"dt-center",mRender:function(n){return n.distrito}},{title:"Estado",data:null,visible:!0,width:"100px",className:"dt-center",mRender:function(n){return n.estadoLocal.idEstadoLocal==1?'<i class="fa fa-check-circle-o" style="color:green;font-size:15px;"><\/i> <span style="color:green"> '+n.estadoLocal.descripcion+" <\/span>":'<i class="fa fa-ban" style="color:red;font-size:15px;"><\/i><span style="color:red"> '+n.estadoLocal.descripcion+" <\/span> "}},{title:"Action",data:null,width:"60px",className:"dt-center",mRender:function(n,t,i,r){return"<div class='btn-group'> <button data-toggle='dropdown' class='btn btn-sm fa fa-bars'><\/button><ul class='dropdown-menu' > <li> <a class='dropdown-item' href='#' id='lnkVer' data-fila='"+r.row+"' data-id-fila='"+n.idLocal+"' data-toggle='modal' data-target='#myModalVer' data-backdrop='static' data-keyboard='false'>Ver<\/a><\/li> <li> <a class='dropdown-item' href='#' id='lnkActualizar' data-fila='"+r.row+"' data-id-fila='"+n.idLocal+"' data-toggle='modal' data-target='#myModal' data-backdrop='static' data-keyboard='false'>Editar<\/a><\/li> "+(n.estadoLocal.idEstadoLocal!=1?"<li><a class='dropdown-item' href='#' id='lnkActivar' data-fila='"+r.row+"' data-id-fila='"+n.idLocal+"' data-toggle='modal' data-target='#myModalEstado' data-backdrop='static' data-keyboard='false'> Activar <\/a><\/li>":"<li><a class='dropdown-item' href='#' id='lnkDesactivar' data-fila='"+r.row+"' data-id-fila='"+n.idLocal+"' data-toggle='modal' data-target='#myModalEstado' data-backdrop='static' data-keyboard='false'> Desactivar <\/a><\/li> ")+"<li> <a class='dropdown-item' href='#' id='lnkUpload' data-fila='"+r.row+"' data-id-fila='"+n.idLocal+"' data-toggle='modal' data-target='#myModalUpload' data-backdrop='static' data-keyboard='false'>Subir Imagen de Tienda<\/a><\/li> <\/ul > <\/div>"}}]}},CargaModal:function(t,i,r){coreajax.ajax.PostAsync(t,i,function(t){var u,f,i,e;t.success?(u=parseInt(n.GlobalModal.idLocal.val()),n.Eventos.LimpiarModal(),n.GlobalModal.cluster.CreateSelected(t.result.clusterLocal,"idClusterLocal","descripcion"),n.GlobalModal.tipo.CreateSelected(t.result.tipoLocal,"idTipoLocal","descripcion"),n.GlobalModal.estado.CreateSelected(t.result.estadoLocal,"idEstadoLocal","descripcion"),n.GlobalModal.tipo.prop("selectedIndex",1),n.GlobalModal.cluster.prop("selectedIndex",1),u===0?n.GlobalModal.title.html("Agregar Tienda"):(f=n.Globals.tblinformaciontienda.DataTable(),i=f.row(r).data(),n.GlobalModal.title.html("Tienda "+i.descripcionLocal),n.GlobalModal.idLocal.val(i.idLocal),n.GlobalModal.codigo.val(i.codigoLocal),n.GlobalModal.codigo.attr("readonly","readonly"),n.GlobalModal.codigo.attr("disabled","disabled"),n.GlobalModal.nombre.val(i.descripcionLocal),n.GlobalModal.nombrealternativo.val(i.descripcionAlternativa),n.GlobalModal.direccion.val(i.direccion),n.GlobalModal.departamento.val(i.departamento),n.GlobalModal.provincia.val(i.provincia),n.GlobalModal.distrito.val(i.distrito),n.GlobalModal.dias.val(i.dias),n.GlobalModal.horario.val(i.horario),n.GlobalModal.telefono.val(i.telefono),n.GlobalModal.x.val(i.x),n.GlobalModal.y.val(i.y),n.GlobalModal.ubicacion.val(i.geolocalizacion),n.GlobalModal.estado.val(i.estadoLocal.idEstadoLocal),n.GlobalModal.cluster.val(i.clusterLocal.idClusterLocal),n.GlobalModal.tipo.val(i.tipoLocal.idTipoLocal),e=i.esPuntoRetiro?"P":"T",n.GlobalModal.esPuntoRetiro.filter("[value='"+e+"']").prop("checked",!0),n.GlobalModal.imagenLocal.attr("src",i.imagen))):toastr.error(t.message,conexion.titulo,{timeOut:1e3});$.msg("unblock")})},Transacion:function(t,i){coreajax.ajax.PostAsync(t,i,function(t){t.success?(toastr.success("Se registro correctamente",conexion.titulo,{timeOut:1e3}),n.GlobalModal.formulario.find(".close").click(),n.Eventos.ValidaListar()):toastr.error(t.message,conexion.titulo,{timeOut:1e3});$.msg("unblock")})},TransacionEstado:function(t,i){coreajax.ajax.PostAsync(t,i,function(t){t.success?(toastr.success("Se actualizo correctamente",conexion.titulo,{timeOut:1e3}),n.GlobalModalEstado.formulario.find(".close").click(),n.Eventos.ValidaListar()):toastr.error(t.message,conexion.titulo,{timeOut:1e3});$.msg("unblock")})}};n.Eventos={InicializarCarga:function(){var t=string_api(conexion.api,"api/Local/LocalCargaInicial"),i=entidadmodel.localFiltroDto();n.Funciones.Carga(t,i)},ValidaListar:function(t){var r=string_api(conexion.api,"api/Local/GetAllLocalTottus"),i=entidadmodel.localFiltroDto();i.idEstadoLocal=parseInt(n.Globals.estado.values());i.idTipoLocal=parseInt(n.Globals.tipo.values());i.idClusterLocal=parseInt(n.Globals.cluster.values());i.esPuntoRetiro=n.Globals.esPuntoRetiro.filter(":checked").val()=="P"?!0:!1;n.Funciones.Listar(r,i);t!==undefined&&t.preventDefault()},ValidaRegistrar:function(){n.GlobalModal.idLocal.val(0);var t=string_api(conexion.api,"api/Local/LocalCargaInicial"),i=entidadmodel.localFiltroDto();n.Funciones.CargaModal(t,i,undefined);n.Eventos.Rule()},LimpiarModal:function(){n.GlobalModal.codigo.val("");n.GlobalModal.nombre.val("");n.GlobalModal.nombrealternativo.val("");n.GlobalModal.direccion.val("");n.GlobalModal.departamento.val("");n.GlobalModal.provincia.val("");n.GlobalModal.distrito.val("");n.GlobalModal.dias.val("");n.GlobalModal.horario.val("");n.GlobalModal.telefono.val("");n.GlobalModal.x.val("");n.GlobalModal.y.val("");n.GlobalModal.ubicacion.val("");n.GlobalModal.estado.ClearSelect();n.GlobalModal.cluster.ClearSelect();n.GlobalModal.tipo.ClearSelect();n.GlobalModal.esPuntoRetiro.filter("[value='T']").prop("checked",!0)},ValidaVer:function(){var i=$(this).attr("data-fila"),r=n.Globals.tblinformaciontienda.DataTable(),t=r.row(i).data();n.GlobalModalVer.title.html("Tienda "+t.descripcionLocal);n.GlobalModalVer.codigo.html(t.codigoLocal);n.GlobalModalVer.nombre.html(t.descripcionLocal);t.descripcionAlternativa==""?n.GlobalModalVer.nombrealternativo.html("-"):n.GlobalModalVer.nombrealternativo.html(t.descripcionAlternativa);n.GlobalModalVer.direccion.html(t.direccion);n.GlobalModalVer.tipo.html(t.tipoLocal.descripcion);n.GlobalModalVer.cluster.html(t.clusterLocal.descripcion);n.GlobalModalVer.estado.html(t.estadoLocal.descripcion);n.GlobalModalVer.departamento.html(t.departamento);n.GlobalModalVer.provincia.html(t.provincia);n.GlobalModalVer.distrito.html(t.distrito);n.GlobalModalVer.dias.html(t.dias);n.GlobalModalVer.horario.html(t.horario);n.GlobalModalVer.telefono.html(t.telefono);n.GlobalModalVer.x.html(t.x);n.GlobalModalVer.y.html(t.y);n.GlobalModalVer.ubicacion.attr("href",t.geolocalizacion);n.GlobalModalVer.ubicacion.attr("target","_blank");n.GlobalModalVer.imagenLocal.attr("src",t.imagen)},ValidaActulizar:function(){var r=$(this).attr("data-fila"),u=$(this).attr("data-id-fila"),t,i;n.GlobalModal.idLocal.val(u);t=string_api(conexion.api,"api/Local/LocalCargaInicial");i=entidadmodel.localFiltroDto();n.Funciones.CargaModal(t,i,r);n.Eventos.Rule()},ValidaActivar:function(){var r=$(this).attr("data-fila"),u=$(this).attr("data-id-fila"),t,i;n.GlobalModal.idLocal.val(u);t=n.Globals.tblinformaciontienda.DataTable();i=t.row(r).data();n.GlobalModalEstado.title.html("¿Deseas activar la Tienda "+i.descripcionLocal+"?");n.GlobalModalEstado.bottonestado.html("Si, deseo activarla");n.GlobalModalEstado.IdEstado.val("1");n.GlobalModalEstado.nota.html(" ");n.Eventos.RuleEstado()},ValidaDesactivar:function(){var r=$(this).attr("data-fila"),u=$(this).attr("data-id-fila"),t,i;n.GlobalModal.idLocal.val(u);t=n.Globals.tblinformaciontienda.DataTable();i=t.row(r).data();n.GlobalModalEstado.title.html("¿Deseas desactivar la Tienda "+i.descripcionLocal+"?");n.GlobalModalEstado.bottonestado.html("Si, deseo desactivarla");n.GlobalModalEstado.IdEstado.val("2");n.GlobalModalEstado.nota.html(" ");n.Eventos.RuleEstado()},ValidaUploadImage:function(){},ValidaTransacionEstado:function(){var i=string_api(conexion.api,"api/Local/UpdateStatusLocal"),t=entidadmodel.locales(),r=parseInt(n.GlobalModal.idLocal.val());t.idLocal=r;t.estadoLocal.idEstadoLocal=n.GlobalModalEstado.IdEstado.val();n.Funciones.TransacionEstado(i,t)},ValidaTransacion:function(){var t=entidadmodel.locales(),i=parseInt(n.GlobalModal.idLocal.val());t.idLocal=i;t.codigoLocal=n.GlobalModal.codigo.val();t.descripcionLocal=n.GlobalModal.nombre.val();t.descripcionAlternativa=n.GlobalModal.nombrealternativo.val();t.direccion=n.GlobalModal.direccion.val();t.departamento=n.GlobalModal.departamento.val();t.provincia=n.GlobalModal.provincia.val();t.distrito=n.GlobalModal.distrito.val();t.dias=n.GlobalModal.dias.val();t.horario=n.GlobalModal.horario.val();t.telefono=n.GlobalModal.telefono.val();t.x=n.GlobalModal.x.val();t.y=n.GlobalModal.y.val();t.geolocalizacion=n.GlobalModal.ubicacion.val();t.estadoLocal.idEstadoLocal=n.GlobalModal.estado.val();t.clusterLocal.idClusterLocal=n.GlobalModal.cluster.val();t.tipoLocal.idTipoLocal=n.GlobalModal.tipo.val();t.esPuntoRetiro=n.GlobalModal.esPuntoRetiro.filter(":checked").val()=="P"?!0:!1;i===0?n.Funciones.Transacion(string_api(conexion.api,"api/Local/InsertLocal"),t):n.Funciones.Transacion(string_api(conexion.api,"api/Local/UpdateLocal"),t)},Rule:function(){$(n.GlobalModal.formulario).validate({rules:{txtCodigo:{required:!0,number:!0},txtNombre:{required:!0,spacelettersonlyNumber:{depends:function(n){var t=$(n).val();return t.length>0?!0:!1}}},txtNombreAlternativo:{required:{depends:function(n){var t=$(n).val();return t.length>0?!0:!1}},spacelettersonlyNumber:{depends:function(n){var t=$(n).val();return t.length>0?!0:!1}}},txtDireccion:{required:!0},txtDepartamento:{required:!0,lettersonly:!0},txtProvincia:{required:!0,lettersonly:!0},txtDistrito:{required:!0,lettersonly:!0},txtDias:{required:!0},horario:{required:!0},txtTelefono:{required:!0,number:!0},txtCoordenadax:{required:!0},txtCoordenaday:{required:!0},txtUbicacion:{required:!0},cboTipoLocalModal:{required:!0,valueNotEquals:"0"},cboClusterModal:{required:!0,valueNotEquals:"0"},cboEstadoModal:{required:!0,valueNotEquals:"0"}},messages:{txtCodigo:{required:"* ingrese codigo",number:"* el codigo es solo numero"},txtNombre:{required:"* ingrese nombre",spacelettersonlyNumber:"* el nombre es letras y numeros"},txtNombreAlternativo:{required:"* ingrese nombre alternativo",spacelettersonlyNumber:"* el nombre es letras y numeros"},txtDireccion:{required:"* ingrese la dirección"},txtDepartamento:{required:"* ingrese departamento",lettersonly:"* el departamento es solo letras"},txtProvincia:{required:"* ingrese provincia",lettersonly:"* la provincia es solo letras"},txtDistrito:{required:"* ingrese distrito",lettersonly:"* el distrito es solo letras"},txtDias:{required:"* ingrese dias"},horario:{required:"* ingrese el horario"},txtTelefono:{required:"* ingrese telefono",number:"* el telefono es solo numero"},txtCoordenadax:{required:"* ingrese la latitup"},txtCoordenaday:{required:"* ingrese la longitud"},txtUbicacion:{required:"* ingrese ubicación"},cboTipoLocalModal:{required:"* seleccione el tipo local",valueNotEquals:"* seleccione el tipo local"},cboClusterModal:{required:"* seleccione el cluster",valueNotEquals:"* seleccione el cluster"},cboEstadoModal:{required:"* seleccione el estado",valueNotEquals:"* seleccione el estado"}},highlight:function(n){$(n).closest(".control-group").removeClass("success").addClass("error")},success:function(n){$(n).addClass("valid").closest(".control-group").removeClass("error").addClass("success")},submitHandler:function(){n.Eventos.ValidaTransacion()}})},RuleEstado:function(){$(n.GlobalModalEstado.formulario).validate({rules:{txtNota:{required:!0},hddIdLocal:{required:!0}},messages:{txtNota:{required:"* ingrese nota"},hddIdLocal:{required:"* no tiene id"}},highlight:function(n){$(n).closest(".control-group").removeClass("success").addClass("error")},success:function(n){$(n).addClass("valid").closest(".control-group").removeClass("error").addClass("success")},submitHandler:function(){n.Eventos.ValidaTransacionEstado()}})}};n.Inicializar=function(){n.Funciones.InicializarEventos();n.Funciones.InicializarAcciones();n.Eventos.InicializarCarga()}};$(document).ready(function(){const n=new mainmntolocales;n.Inicializar()});